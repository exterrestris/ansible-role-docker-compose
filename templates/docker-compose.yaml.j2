version: '{{ docker_compose_schema_version }}'

services:
{% for container in docker_compose_containers %}
  {{ container.service_name }}:
    image: {{ container.image }}
{% if container.ports | length > 0 %}
    ports:
{% for port in container.ports %}
{% if port is mapping %}
      - "{% if port.ip is defined %}{{ port.ip }}:{% endif %}{{ port.host | default(port.port) }}:{{ port.container | default(port.port) }}{% if port.protocol is defined %}/{{ port.protocol }}{% endif %}"
{% else %}
      - "{{ port }}"
{% endif%}
{% endfor %}
{% endif%}
{% if container.volumes | length > 0 %}
    volumes:
{% for volume in container.volumes %}
{% if volume is mapping %}
      - "{{ volume.source }}:{{ volume.target }}"
{% else %}
      - "{{ volume }}"
{% endif%}
{% endfor %}
{% endif%}
{% if container.environment | length > 0 %}
    environment:
{% for env in container.environment %}
{% if env is mapping %}
      - "{{ env.name }}={{ env.value}}"
{% else %}
      - "{{ env }}"
{% endif%}
{% endfor %}
{% endif%}
{% endfor %}
